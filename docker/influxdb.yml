# Fail if .env is missing
x-env-file: &env-file
    env_file:
        - ./../.env

networks:
    default:
        driver: bridge

services:
    influxdb:
        <<: *env-file # Include env file check
        image: influxdb:latest
        container_name: influxdb
        restart: unless-stopped
        ports:
            - "8086:8086"
        volumes:
            - ./influxdb/config:/etc/influxdb2:Z
            - ./influxdb/data:/var/lib/influxdb2:Z
        environment:
            - DOCKER_INFLUXDB_INIT_MODE=setup
            - DOCKER_INFLUXDB_INIT_USERNAME=${INFLUX_USER:-admin}
            - DOCKER_INFLUXDB_INIT_PASSWORD=${INFLUX_PASS:-admin}
            - DOCKER_INFLUXDB_INIT_ORG=${INFLUX_ORG:-default_org}
            - DOCKER_INFLUXDB_INIT_BUCKET=${INFLUX_BUCKET:-default_bucket}
            - DOCKER_INFLUXDB_INIT_ADMIN_TOKEN=${INFLUX_TOKEN:-super_secret_token}
            - DOCKER_INFLUXDB_INIT_RETENTION=${INFLUX_RETENTION:-0}
            - DOCKER_INFLUXDB_INIT_HOST=${INFLUX_URL:-http://localhost:8086}
            - LOG_LEVEL=${LOG_LEVEL:-INFO}
